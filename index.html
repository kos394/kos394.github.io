<script>
    // ============================================
    // –ì–õ–û–ë–ê–õ–¨–ù–´–ï –ü–ï–†–ï–ú–ï–ù–ù–´–ï
    // ============================================
    
    const STORAGE_KEY = 'debt_freedom_plan_2026';
    const motivationMessages = [
        "–ö–∞–∂–¥—ã–π –ø–ª–∞—Ç–µ–∂ ‚Äî —à–∞–≥ –∫ —Å–æ–ª–Ω—Ü—É! ‚òÄÔ∏è",
        "–¢—ã —Å–∏–ª—å–Ω–µ–µ, —á–µ–º —ç—Ç–∏ —Ü–∏—Ñ—Ä—ã! üí™",
        "–°–≤–æ–±–æ–¥–∞ –±–ª–∏–∂–µ, —á–µ–º –∫–∞–∂–µ—Ç—Å—è! üïäÔ∏è",
        "–¢–≤–æ—ë —Ç–µ—Ä–ø–µ–Ω–∏–µ –ø—Ä–µ–≤—Ä–∞—â–∞–µ—Ç—Å—è –≤ —Å–≤–æ–±–æ–¥—É! ‚ú®",
        "–ö–∞–∂–¥—ã–π —Ä—É–±–ª—å ‚Äî –∫–∏—Ä–ø–∏—á–∏–∫ –≤ —Å—Ç–µ–Ω–µ —Ç–≤–æ–µ–π –Ω–µ–∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏! üß±",
        "–£ —Ç–µ–±—è –µ—Å—Ç—å –ø–ª–∞–Ω ‚Äî –∑–Ω–∞—á–∏—Ç, —Ç—ã —É–∂–µ –ø–æ–±–µ–¥–∏–ª! üéØ",
        "–î–æ–ª–≥–∏ –≤—Ä–µ–º–µ–Ω–Ω—ã, —Å–≤–æ–±–æ–¥–∞ –≤–µ—á–Ω–∞! üåÖ",
        "–°–µ–≥–æ–¥–Ω—è—à–Ω–∏–π –ø–ª–∞—Ç–µ–∂ ‚Äî –∑–∞–≤—Ç—Ä–∞—à–Ω—è—è —Å–≤–æ–±–æ–¥–∞! üéâ",
        "–¢—ã –∫–æ–Ω—Ç—Ä–æ–ª–∏—Ä—É–µ—à—å —Ü–∏—Ñ—Ä—ã, –∞ –Ω–µ –æ–Ω–∏ —Ç–µ–±—è! üìä",
        "–ö–∞–∂–¥—ã–π –∑–∞–∫—Ä—ã—Ç—ã–π –∫—Ä–µ–¥–∏—Ç ‚Äî —ç—Ç–æ –ø–æ–±–µ–¥–∞! üèÜ"
    ];
    
    let userData = {
        debt: 500000,
        payment: 25000,
        interest: 15,
        startDate: null,
        completedMonths: 0,
        totalMonths: 0,
        freedomDate: null,
        lastSaved: null,
        achievements: [],
        paymentHistory: [],
        monthlyDetails: [] // –•–†–ê–ù–ò–ú –í–°–ï –ú–ï–°–Ø–¶–´
    };
    
    // –≠–ª–µ–º–µ–Ω—Ç—ã DOM
    const debtSlider = document.getElementById('debtSlider');
    const paymentSlider = document.getElementById('paymentSlider');
    const interestSlider = document.getElementById('interestSlider');
    const debtValue = document.getElementById('debtValue');
    const paymentValue = document.getElementById('paymentValue');
    const interestValue = document.getElementById('interestValue');
    const resultsContainer = document.getElementById('resultsContainer');
    const paymentTableContainer = document.getElementById('paymentTableContainer');
    const paymentTable = document.getElementById('paymentTable');
    const progressFill = document.getElementById('progressFill');
    const progressText = document.getElementById('progressText');
    const monthsLeft = document.getElementById('monthsLeft');
    const countdownContainer = document.getElementById('countdownContainer');
    const achievementsContainer = document.getElementById('achievementsContainer');
    const feedbackModal = document.getElementById('feedbackModal');
    const feedbackForm = document.getElementById('feedbackForm');
    
    // ============================================
    // –ú–û–î–ê–õ–¨–ù–û–ï –û–ö–ù–û –î–õ–Ø –û–¢–ó–´–í–û–í
    // ============================================
    
    function openFeedbackModal() {
        feedbackModal.style.display = 'flex';
        document.body.style.overflow = 'hidden';
    }
    
    function closeModal() {
        feedbackModal.style.display = 'none';
        document.body.style.overflow = 'auto';
    }
    
    feedbackModal.addEventListener('click', function(e) {
        if (e.target === feedbackModal) {
            closeModal();
        }
    });
    
    feedbackForm.addEventListener('submit', function(e) {
        e.preventDefault();
        
        const name = document.getElementById('feedbackName').value || '–ê–Ω–æ–Ω–∏–º';
        const debt = document.getElementById('feedbackDebt').value;
        const strategy = document.getElementById('feedbackStrategy').value;
        const story = document.getElementById('feedbackStory').value;
        const advice = document.getElementById('feedbackAdvice').value;
        const isAnonymous = document.getElementById('feedbackAnonymous').checked;
        
        if (!story.trim()) {
            showMotivation('üìù –ü–æ–∂–∞–ª—É–π—Å—Ç–∞, —Ä–∞—Å—Å–∫–∞–∂–∏ —Å–≤–æ—é –∏—Å—Ç–æ—Ä–∏—é!');
            return;
        }
        
        const feedback = {
            id: Date.now(),
            name: isAnonymous ? '–ê–Ω–æ–Ω–∏–º' : (name || '–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å'),
            debt: debt || '–ù–µ —É–∫–∞–∑–∞–Ω–æ',
            strategy: getStrategyName(strategy),
            story: story,
            advice: advice || '–ë—É–¥—å—Ç–µ –Ω–∞—Å—Ç–æ–π—á–∏–≤—ã!',
            date: new Date().toISOString(),
            status: 'pending'
        };
        
        saveFeedback(feedback);
        
        feedbackForm.reset();
        closeModal();
        
        showMotivation('‚ú® –°–ø–∞—Å–∏–±–æ –∑–∞ —Ç–≤–æ—é –∏—Å—Ç–æ—Ä–∏—é! –ú—ã –ø—Ä–æ–≤–µ—Ä–∏–º –∏ –¥–æ–±–∞–≤–∏–º –µ—ë –Ω–∞ —Å–∞–π—Ç.');
        console.log('–û—Ç–∑—ã–≤ –ø–æ–ª—É—á–µ–Ω:', feedback);
    });
    
    function getStrategyName(strategy) {
        switch(strategy) {
            case 'standard': return '–°—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–π –ø–ª–∞–Ω';
            case 'accelerated': return '–£—Å–∫–æ—Ä–µ–Ω–Ω—ã–π –ø–ª–∞–Ω';
            case 'restructuring': return '–†–µ—Å—Ç—Ä—É–∫—Ç—É—Ä–∏–∑–∞—Ü–∏—è';
            case 'other': return '–î—Ä—É–≥–∞—è —Å—Ç—Ä–∞—Ç–µ–≥–∏—è';
            default: return '–ù–µ —É–∫–∞–∑–∞–Ω–æ';
        }
    }
    
    function saveFeedback(feedback) {
        try {
            let feedbacks = JSON.parse(localStorage.getItem('debt_feedbacks') || '[]');
            feedbacks.push(feedback);
            localStorage.setItem('debt_feedbacks', JSON.stringify(feedbacks));
        } catch (e) {
            console.warn('–ù–µ —É–¥–∞–ª–æ—Å—å —Å–æ—Ö—Ä–∞–Ω–∏—Ç—å –æ—Ç–∑—ã–≤:', e);
        }
    }
    
    // ============================================
    // –û–°–ù–û–í–ù–û–ô –ö–ê–õ–¨–ö–£–õ–Ø–¢–û–† - –ò–°–ü–†–ê–í–õ–ï–ù–ù–´–ô
    // ============================================
    
    function saveToLocalStorage() {
        try {
            userData.lastSaved = new Date().toISOString();
            localStorage.setItem(STORAGE_KEY, JSON.stringify(userData));
            showAutoSaveIndicator();
        } catch (e) {
            console.warn('–ù–µ —É–¥–∞–ª–æ—Å—å —Å–æ—Ö—Ä–∞–Ω–∏—Ç—å –¥–∞–Ω–Ω—ã–µ:', e);
            showMotivation('‚ö†Ô∏è –ù–µ —É–¥–∞–ª–æ—Å—å —Å–æ—Ö—Ä–∞–Ω–∏—Ç—å. –ü—Ä–æ–≤–µ—Ä—å –ø–∞–º—è—Ç—å –±—Ä–∞—É–∑–µ—Ä–∞.');
        }
    }
    
    function loadFromLocalStorage() {
        try {
            const saved = localStorage.getItem(STORAGE_KEY);
            if (saved) {
                const parsed = JSON.parse(saved);
                userData = { ...userData, ...parsed };
                
                // –û–±–Ω–æ–≤–ª—è–µ–º —Å–ª–∞–π–¥–µ—Ä—ã
                debtSlider.value = userData.debt || 500000;
                paymentSlider.value = userData.payment || 25000;
                interestSlider.value = userData.interest || 15;
                
                updateDebt();
                updatePayment();
                updateInterest();
                
                // –í–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –ø—Ä–æ–≥—Ä–µ—Å—Å
                if (userData.totalMonths > 0) {
                    updateProgressBar(userData.completedMonths, userData.totalMonths);
                    updateCountdown();
                    showAchievements();
                    
                    // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Ç–∞–±–ª–∏—Ü—É –ø–ª–∞—Ç–µ–∂–µ–π
                    if (userData.monthlyDetails && userData.monthlyDetails.length > 0) {
                        displayPaymentTable(userData.monthlyDetails);
                    }
                }
            }
        } catch (e) {
            console.warn('–ù–µ —É–¥–∞–ª–æ—Å—å –∑–∞–≥—Ä—É–∑–∏—Ç—å –¥–∞–Ω–Ω—ã–µ:', e);
            localStorage.removeItem(STORAGE_KEY);
        }
    }
    
    function clearAllData() {
        if (confirm('–¢–æ—á–Ω–æ —É–¥–∞–ª–∏—Ç—å –≤—Å–µ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ? –≠—Ç–æ –¥–µ–π—Å—Ç–≤–∏–µ –Ω–µ–ª—å–∑—è –æ—Ç–º–µ–Ω–∏—Ç—å.')) {
            localStorage.removeItem(STORAGE_KEY);
            userData = {
                debt: 500000,
                payment: 25000,
                interest: 15,
                startDate: null,
                completedMonths: 0,
                totalMonths: 0,
                freedomDate: null,
                lastSaved: null,
                achievements: [],
                paymentHistory: [],
                monthlyDetails: []
            };
            
            debtSlider.value = 500000;
            paymentSlider.value = 25000;
            interestSlider.value = 15;
            
            updateDebt();
            updatePayment();
            updateInterest();
            
            progressFill.style.width = '0%';
            progressText.textContent = '–ü—Ä–æ–≥—Ä–µ—Å—Å: 0%';
            monthsLeft.textContent = '–û—Å—Ç–∞–ª–æ—Å—å: 0 –º–µ—Å—è—Ü–µ–≤';
            countdownContainer.style.display = 'none';
            paymentTableContainer.style.display = 'none';
            achievementsContainer.innerHTML = `
                <p>–ó–¥–µ—Å—å –±—É–¥—É—Ç –æ—Ç–æ–±—Ä–∞–∂–∞—Ç—å—Å—è —Ç–≤–æ–∏ —É—Å–ø–µ—Ö–∏ –≤ –ø–æ–≥–∞—à–µ–Ω–∏–∏ –¥–æ–ª–≥–æ–≤!</p>
                <p>–ù–∞—á–Ω–∏ —Å —Ä–∞—Å—á–µ—Ç–∞ –ø–ª–∞–Ω–∞ –∏ –æ—Ç–º–µ—á–∞–π –≤—ã–ø–æ–ª–Ω–µ–Ω–Ω—ã–µ –ø–ª–∞—Ç–µ–∂–∏.</p>
            `;
            
            showMotivation('üéØ –ù–∞—á–Ω–∏ —Å–≤–æ–π –ø—É—Ç—å –∫ —Å–≤–æ–±–æ–¥–µ –∑–∞–Ω–æ–≤–æ!');
        }
    }
    
    function formatNumber(num) {
        return new Intl.NumberFormat('ru-RU').format(Math.round(num));
    }
    
    function updateDebt() {
        const value = parseInt(debtSlider.value);
        debtValue.textContent = formatNumber(value) + ' ‚ÇΩ';
        userData.debt = value;
        calculateFullPlanWithAllMonths(); // –†–ê–°–°–ß–ò–¢–´–í–ê–ï–ú –ü–û–õ–ù–´–ô –ü–õ–ê–ù –°–†–ê–ó–£
        saveToLocalStorage();
    }
    
    function updatePayment() {
        const value = parseInt(paymentSlider.value);
        paymentValue.textContent = formatNumber(value) + ' ‚ÇΩ';
        userData.payment = value;
        calculateFullPlanWithAllMonths(); // –†–ê–°–°–ß–ò–¢–´–í–ê–ï–ú –ü–û–õ–ù–´–ô –ü–õ–ê–ù –°–†–ê–ó–£
        saveToLocalStorage();
    }
    
    function updateInterest() {
        const value = parseFloat(interestSlider.value);
        interestValue.textContent = value.toFixed(1) + '%';
        userData.interest = value;
        calculateFullPlanWithAllMonths(); // –†–ê–°–°–ß–ò–¢–´–í–ê–ï–ú –ü–û–õ–ù–´–ô –ü–õ–ê–ù –°–†–ê–ó–£
        saveToLocalStorage();
    }
    
    // ============================================
    // –ì–õ–ê–í–ù–ê–Ø –§–£–ù–ö–¶–ò–Ø –†–ê–°–ß–ï–¢–ê - –ü–û–ö–ê–ó–´–í–ê–ï–¢ –í–°–ï –ú–ï–°–Ø–¶–´
    // ============================================
    
    function calculateFullPlanWithAllMonths() {
        const debt = parseInt(debtSlider.value);
        const monthlyPayment = parseInt(paymentSlider.value);
        const monthlyInterestRate = parseFloat(interestSlider.value) / 100 / 12;
        
        if (monthlyPayment <= 0 || debt <= 0) return;
        
        let remainingDebt = debt;
        let months = 0;
        let totalInterestPaid = 0;
        const monthlyDetails = [];
        
        // –†–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ–º –í–°–ï –º–µ—Å—è—Ü—ã –¥–æ –ø–æ–ª–Ω–æ–≥–æ –ø–æ–≥–∞—à–µ–Ω–∏—è
        while (remainingDebt > 0 && months < 600) { // 600 –º–µ—Å—è—Ü–µ–≤ = 50 –ª–µ—Ç –º–∞–∫—Å–∏–º—É–º
            const interestThisMonth = remainingDebt * monthlyInterestRate;
            const principalThisMonth = Math.min(monthlyPayment - interestThisMonth, remainingDebt);
            
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –º–æ–∂–µ—Ç –ª–∏ –±—ã—Ç—å –ø–æ–≥–∞—à–µ–Ω –¥–æ–ª–≥
            if (principalThisMonth <= 0) {
                // –ü–ª–∞—Ç–µ–∂ –º–µ–Ω—å—à–µ –ø—Ä–æ—Ü–µ–Ω—Ç–æ–≤ - –ø–ª–∞–Ω –Ω–µ–≤–æ–∑–º–æ–∂–µ–Ω
                showImpossiblePlan(debt, monthlyPayment, monthlyInterestRate);
                return;
            }
            
            totalInterestPaid += interestThisMonth;
            remainingDebt -= principalThisMonth;
            months++;
            
            // –°–æ—Ö—Ä–∞–Ω—è–µ–º –¥–∞–Ω–Ω—ã–µ –¥–ª—è –ö–ê–ñ–î–û–ì–û –º–µ—Å—è—Ü–∞
            monthlyDetails.push({
                month: months,
                payment: monthlyPayment,
                interest: interestThisMonth,
                principal: principalThisMonth,
                remaining: remainingDebt > 0 ? remainingDebt : 0,
                totalPaid: debt - remainingDebt + totalInterestPaid
            });
        }
        
        if (months >= 600) {
            showImpossiblePlan(debt, monthlyPayment, monthlyInterestRate);
            return;
        }
        
        // –°–æ—Ö—Ä–∞–Ω—è–µ–º –¥–∞–Ω–Ω—ã–µ
        userData.totalMonths = months;
        userData.startDate = userData.startDate || new Date().toISOString();
        userData.monthlyDetails = monthlyDetails;
        
        // –†–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ–º –¥–∞—Ç—É –æ—Å–≤–æ–±–æ–∂–¥–µ–Ω–∏—è
        const freedomDate = new Date();
        freedomDate.setMonth(freedomDate.getMonth() + months);
        userData.freedomDate = freedomDate.toLocaleDateString('ru-RU', {
            day: '2-digit',
            month: '2-digit',
            year: 'numeric'
        });
        
        // –û–±–Ω–æ–≤–ª—è–µ–º –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å
        updateResults(debt, monthlyPayment, monthlyInterestRate, months, totalInterestPaid, userData.freedomDate);
        updateProgressBar(userData.completedMonths, months);
        updateCountdown();
        
        // –ü–û–ö–ê–ó–´–í–ê–ï–ú –í–ï–°–¨ –ì–†–ê–§–ò–ö –ü–õ–ê–¢–ï–ñ–ï–ô
        displayPaymentTable(monthlyDetails);
        
        saveToLocalStorage();
        
        if (Math.random() > 0.7) {
            showRandomMotivation();
        }
    }
    
    function displayPaymentTable(monthlyDetails) {
        if (!monthlyDetails || monthlyDetails.length === 0) {
            paymentTableContainer.style.display = 'none';
            return;
        }
        
        let tableHTML = `
            <div class="table-row" style="background: #E3F2FD; font-weight: bold; position: sticky; top: 0; z-index: 10;">
                <div class="table-cell">–ú–µ—Å—è—Ü</div>
                <div class="table-cell">–î–∞—Ç–∞ –ø–ª–∞—Ç–µ–∂–∞</div>
                <div class="table-cell">–ü–ª–∞—Ç–µ–∂</div>
                <div class="table-cell">–ü—Ä–æ—Ü–µ–Ω—Ç—ã</div>
                <div class="table-cell">–û—Å–Ω–æ–≤–Ω–æ–π –¥–æ–ª–≥</div>
                <div class="table-cell">–û—Å—Ç–∞—Ç–æ–∫ –¥–æ–ª–≥–∞</div>
                <div class="table-cell">–°—Ç–∞—Ç—É—Å</div>
            </div>
        `;
        
        const startDate = userData.startDate ? new Date(userData.startDate) : new Date();
        
        // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –í–°–ï –º–µ—Å—è—Ü—ã
        monthlyDetails.forEach(detail => {
            const paymentDate = new Date(startDate);
            paymentDate.setMonth(paymentDate.getMonth() + detail.month - 1);
            
            const dateStr = paymentDate.toLocaleDateString('ru-RU', {
                day: '2-digit',
                month: '2-digit',
                year: 'numeric'
            });
            
            const isPaid = detail.month <= userData.completedMonths;
            const isCurrent = detail.month === userData.completedMonths + 1;
            const rowClass = isCurrent ? 'current-cell' : (isPaid ? 'paid-cell' : '');
            
            let status = '';
            if (isPaid) status = '‚úÖ –í—ã–ø–æ–ª–Ω–µ–Ω–æ';
            else if (isCurrent) status = 'üìç –¢–µ–∫—É—â–∏–π';
            else status = 'üìÖ –û–∂–∏–¥–∞–µ—Ç';
            
            tableHTML += `
                <div class="table-row ${rowClass}">
                    <div class="table-cell"><strong>${detail.month}</strong></div>
                    <div class="table-cell">${dateStr}</div>
                    <div class="table-cell">${formatNumber(detail.payment)} ‚ÇΩ</div>
                    <div class="table-cell">${formatNumber(detail.interest)} ‚ÇΩ</div>
                    <div class="table-cell">${formatNumber(detail.principal)} ‚ÇΩ</div>
                    <div class="table-cell">${formatNumber(detail.remaining)} ‚ÇΩ</div>
                    <div class="table-cell">${status}</div>
                </div>
            `;
        });
        
        // –ò—Ç–æ–≥–æ–≤–∞—è —Å—Ç—Ä–æ–∫–∞
        const totalPayment = monthlyDetails.reduce((sum, detail) => sum + detail.payment, 0);
        const totalInterest = monthlyDetails.reduce((sum, detail) => sum + detail.interest, 0);
        const totalPrincipal = userData.debt;
        
        tableHTML += `
            <div class="table-row" style="background: #FFF8E1; font-weight: bold; position: sticky; bottom: 0; z-index: 10;">
                <div class="table-cell">–ò–¢–û–ì–û –∑–∞ ${monthlyDetails.length} –º–µ—Å.</div>
                <div class="table-cell">${userData.freedomDate}</div>
                <div class="table-cell">${formatNumber(totalPayment)} ‚ÇΩ</div>
                <div class="table-cell">${formatNumber(totalInterest)} ‚ÇΩ</div>
                <div class="table-cell">${formatNumber(totalPrincipal)} ‚ÇΩ</div>
                <div class="table-cell">0 ‚ÇΩ</div>
                <div class="table-cell">${userData.completedMonths >= monthlyDetails.length ? 'üéâ –°–í–û–ë–û–î–ê!' : '–í –ø—Ä–æ—Ü–µ—Å—Å–µ'}</div>
            </div>
        `;
        
        paymentTable.innerHTML = tableHTML;
        paymentTableContainer.style.display = 'block';
        
        // –î–µ–ª–∞–µ–º —Ç–∞–±–ª–∏—Ü—É –ø—Ä–æ–∫—Ä—É—á–∏–≤–∞–µ–º–æ–π
        paymentTable.style.maxHeight = '500px';
        paymentTable.style.overflowY = 'auto';
        paymentTable.style.display = 'block';
        
        // –ü—Ä–æ–∫—Ä—É—á–∏–≤–∞–µ–º –∫ —Ç–µ–∫—É—â–µ–º—É –º–µ—Å—è—Ü—É
        setTimeout(() => {
            const currentRows = document.querySelectorAll('.current-cell');
            if (currentRows.length > 0) {
                currentRows[0].scrollIntoView({ 
                    behavior: 'smooth', 
                    block: 'center' 
                });
            }
        }, 100);
        
        // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Å–∫–æ–ª—å–∫–æ –º–µ—Å—è—Ü–µ–≤ –≤—Å–µ–≥–æ
        showMotivation(`üìä –†–∞—Å—Å—á–∏—Ç–∞–Ω –ø–ª–∞–Ω –Ω–∞ ${monthlyDetails.length} –º–µ—Å—è—Ü–µ–≤!`);
    }
    
    function showImpossiblePlan(debt, payment, monthlyInterestRate) {
        const monthlyInterest = debt * monthlyInterestRate;
        const neededPayment = monthlyInterest * 1.1; // –ù—É–∂–Ω–æ –ø–ª–∞—Ç–∏—Ç—å –Ω–∞ 10% –±–æ–ª—å—à–µ –ø—Ä–æ—Ü–µ–Ω—Ç–æ–≤
        
        resultsContainer.innerHTML = `
            <div class="result-card" style="grid-column: 1 / -1; background: #FFEBEE; border-color: #F44336;">
                <span class="result-icon">‚ö†Ô∏è</span>
                <div class="result-value" style="color: #D32F2F;">–ü–õ–ê–ù –ù–ï–í–û–ó–ú–û–ñ–ï–ù</div>
                <div class="result-label">
                    <strong>–ü—Ä–∏—á–∏–Ω–∞:</strong> –ï–∂–µ–º–µ—Å—è—á–Ω—ã–π –ø–ª–∞—Ç–µ–∂ (${formatNumber(payment)} ‚ÇΩ) –º–µ–Ω—å—à–µ –ø—Ä–æ—Ü–µ–Ω—Ç–æ–≤ (${formatNumber(monthlyInterest)} ‚ÇΩ)<br><br>
                    <strong>–ß—Ç–æ –¥–µ–ª–∞—Ç—å:</strong> 
                    <ol style="text-align: left; margin: 15px 0; padding-left: 20px;">
                        <li>–£–≤–µ–ª–∏—á—å –ø–ª–∞—Ç–µ–∂ –¥–æ <strong>${formatNumber(neededPayment)} ‚ÇΩ</strong> –∏–ª–∏ –±–æ–ª—å—à–µ</li>
                        <li>–ò–ª–∏ –≤—ã–±–µ—Ä–∏ "–ü–ª–∞–Ω —Ä–µ—Å—Ç—Ä—É–∫—Ç—É—Ä–∏–∑–∞—Ü–∏–∏" –Ω–∏–∂–µ</li>
                        <li>–ò–ª–∏ –¥–æ–≥–æ–≤–æ—Ä–∏—Å—å —Å –±–∞–Ω–∫–æ–º –æ —Å–Ω–∏–∂–µ–Ω–∏–∏ —Å—Ç–∞–≤–∫–∏</li>
                    </ol>
                </div>
            </div>
        `;
        
        paymentTableContainer.style.display = 'none';
        countdownContainer.style.display = 'none';
        userData.totalMonths = 0;
        userData.monthlyDetails = [];
    }
    
    function updateResults(debt, payment, interest, months, totalInterest, freedomDate) {
        const totalPaid = debt + totalInterest;
        
        resultsContainer.innerHTML = `
            <div class="result-card">
                <span class="result-icon">üìÖ</span>
                <div class="result-value">${months} –º–µ—Å</div>
                <div class="result-label">–û–±—â–∏–π —Å—Ä–æ–∫</div>
            </div>
            
            <div class="result-card">
                <span class="result-icon">üåÖ</span>
                <div class="result-value">${freedomDate}</div>
                <div class="result-label">–î–∞—Ç–∞ –æ—Å–≤–æ–±–æ–∂–¥–µ–Ω–∏—è</div>
            </div>
            
            <div class="result-card">
                <span class="result-icon">üí∞</span>
                <div class="result-value">${formatNumber(totalPaid)} ‚ÇΩ</div>
                <div class="result-label">–í—Å–µ–≥–æ –≤—ã–ø–ª–∞—Ç–∏—à—å</div>
            </div>
            
            <div class="result-card">
                <span class="result-icon">üí∏</span>
                <div class="result-value">${formatNumber(totalInterest)} ‚ÇΩ</div>
                <div class="result-label">–ü—Ä–æ—Ü–µ–Ω—Ç—ã –±–∞–Ω–∫—É</div>
            </div>
        `;
        
        countdownContainer.style.display = 'grid';
    }
    
    // ============================================
    // –û–¢–°–õ–ï–ñ–ò–í–ê–ù–ò–ï –ü–†–û–ì–†–ï–°–°–ê
    // ============================================
    
    function markPaymentDone() {
        if (!userData.totalMonths || userData.totalMonths <= 0) {
            alert('–°–Ω–∞—á–∞–ª–∞ —Ä–∞—Å—Å—á–∏—Ç–∞–π —Å–≤–æ–π –ø–ª–∞–Ω!');
            return;
        }
        
        if (userData.completedMonths >= userData.totalMonths) {
            showMotivation('üéâ –¢—ã —É–∂–µ —Å–≤–æ–±–æ–¥–µ–Ω! –í—Å–µ –¥–æ–ª–≥–∏ –ø–æ–≥–∞—à–µ–Ω—ã!');
            return;
        }
        
        userData.completedMonths++;
        
        const paymentDate = new Date();
        userData.paymentHistory.push({
            date: paymentDate.toISOString(),
            amount: userData.payment,
            month: userData.completedMonths
        });
        
        checkAchievements();
        updateProgressBar(userData.completedMonths, userData.totalMonths);
        updateCountdown();
        
        // –û–±–Ω–æ–≤–ª—è–µ–º —Ç–∞–±–ª–∏—Ü—É –ø–ª–∞—Ç–µ–∂–µ–π
        if (userData.monthlyDetails && userData.monthlyDetails.length > 0) {
            displayPaymentTable(userData.monthlyDetails);
        }
        
        saveToLocalStorage();
        showMotivation(getPaymentMotivation());
        
        // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –¥–æ—Å—Ç–∏–≥–Ω—É—Ç–∞ –ª–∏ —Å–≤–æ–±–æ–¥–∞
        if (userData.completedMonths >= userData.totalMonths) {
            setTimeout(() => {
                showMotivation('üéâüéâüéâ –ü–û–ó–î–†–ê–í–õ–Ø–ï–ú! –¢—ã –¥–æ—Å—Ç–∏–≥ —Ñ–∏–Ω–∞–Ω—Å–æ–≤–æ–π —Å–≤–æ–±–æ–¥—ã! üéâüéâüéâ');
                addAchievement('üèÜ –ü–æ–ª–Ω–æ–µ –æ—Å–≤–æ–±–æ–∂–¥–µ–Ω–∏–µ', '–¢—ã –ø–æ–≥–∞—Å–∏–ª –≤—Å–µ –¥–æ–ª–≥–∏!');
            }, 1000);
        }
    }
    
    function updateProgressBar(completedMonths, totalMonths) {
        const progress = totalMonths > 0 ? Math.min(100, (completedMonths / totalMonths) * 100) : 0;
        progressFill.style.width = progress + '%';
        progressText.textContent = `–ü—Ä–æ–≥—Ä–µ—Å—Å: ${progress.toFixed(1)}% (${completedMonths}/${totalMonths} –º–µ—Å—è—Ü–µ–≤)`;
        monthsLeft.textContent = totalMonths - completedMonths > 0 
            ? `–û—Å—Ç–∞–ª–æ—Å—å: ${totalMonths - completedMonths} –º–µ—Å—è—Ü–µ–≤ –¥–æ ${userData.freedomDate}`
            : `üéâ –°–í–û–ë–û–î–ê –î–û–°–¢–ò–ì–ù–£–¢–ê! ${userData.freedomDate}`;
    }
    
    function updateCountdown() {
        if (!userData.totalMonths || userData.totalMonths <= 0) return;
        
        const remainingMonths = userData.totalMonths - userData.completedMonths;
        const remainingDays = Math.round(remainingMonths * 30.4);
        const remainingWeeks = Math.round(remainingMonths * 4.3);
        const remainingPayments = remainingMonths;
        
        document.getElementById('cdMonths').textContent = remainingMonths;
        document.getElementById('cdDays').textContent = remainingDays;
        document.getElementById('cdWeeks').textContent = remainingWeeks;
        document.getElementById('cdPayments').textContent = remainingPayments;
        
        // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º countdown —Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ –æ—Å—Ç–∞–ª–∏—Å—å –ø–ª–∞—Ç–µ–∂–∏
        countdownContainer.style.display = remainingMonths > 0 ? 'grid' : 'none';
    }
    
    function getPaymentMotivation() {
        const percentage = (userData.completedMonths / userData.totalMonths) * 100;
        
        if (percentage >= 100) return 'üéâ –¢–´ –°–í–û–ë–û–î–ï–ù!';
        if (percentage >= 90) return '–ü–æ—á—Ç–∏ —É —Ü–µ–ª–∏! –û—Å—Ç–∞–ª–æ—Å—å —Å–æ–≤—Å–µ–º –Ω–µ–º–Ω–æ–≥–æ! üèÅ';
        if (percentage >= 75) return '–¢—ã –Ω–∞ —Ñ–∏–Ω–∏—à–Ω–æ–π –ø—Ä—è–º–æ–π! üöÄ';
        if (percentage >= 50) return '–ü–æ–ª–æ–≤–∏–Ω–∞ –ø—É—Ç–∏ –ø—Ä–æ–π–¥–µ–Ω–∞! –¢—ã –º–æ–ª–æ–¥–µ—Ü! ‚ú®';
        if (percentage >= 25) return '–£–∂–µ —á–µ—Ç–≤–µ—Ä—Ç—å –ø—É—Ç–∏! –ü—Ä–æ–¥–æ–ª–∂–∞–π –≤ —Ç–æ–º –∂–µ –¥—É—Ö–µ! üí™';
        if (userData.completedMonths === 1) return '–ü–µ—Ä–≤—ã–π –ø–ª–∞—Ç–µ–∂ —Å–¥–µ–ª–∞–Ω! –û—Ç–ª–∏—á–Ω–æ–µ –Ω–∞—á–∞–ª–æ! üéØ';
        
        const messages = [
            `–ü–ª–∞—Ç–µ–∂ ‚Ññ${userData.completedMonths} –≤—ã–ø–æ–ª–Ω–µ–Ω!`,
            `–ï—â–µ –æ–¥–∏–Ω —à–∞–≥ –∫ —Å–≤–æ–±–æ–¥–µ!`,
            `–ù–∞ ${percentage.toFixed(1)}% –±–ª–∏–∂–µ –∫ —Ü–µ–ª–∏!`,
            `–¢–∞–∫ –¥–µ—Ä–∂–∞—Ç—å! –ü—Ä–æ–¥–æ–ª–∂–∞–π!`
        ];
        
        return messages[Math.floor(Math.random() * messages.length)];
    }
    
    // ============================================
    // –î–û–°–¢–ò–ñ–ï–ù–ò–Ø –ò –ü–õ–ê–ù–´
    // ============================================
    
    function checkAchievements() {
        const achievements = [];
        
        if (userData.completedMonths === 1) {
            achievements.push({ title: 'üéØ –ü–µ—Ä–≤—ã–π —à–∞–≥', desc: '–°–¥–µ–ª–∞–Ω –ø–µ—Ä–≤—ã–π –ø–ª–∞—Ç–µ–∂' });
        }
        
        if (userData.completedMonths === 3) {
            achievements.push({ title: 'üìÖ –ü–µ—Ä–≤—ã–π –∫–≤–∞—Ä—Ç–∞–ª', desc: '3 –º–µ—Å—è—Ü–∞ –¥–∏—Å—Ü–∏–ø–ª–∏–Ω—ã' });
        }
        
        if (userData.completedMonths === 6) {
            achievements.push({ title: '‚ú® –ü–æ–ª–≥–æ–¥–∞ –ø—É—Ç–∏', desc: '6 –º–µ—Å—è—Ü–µ–≤ —Ä–µ–≥—É–ª—è—Ä–Ω—ã—Ö –ø–ª–∞—Ç–µ–∂–µ–π' });
        }
        
        const percentage = (userData.completedMonths / userData.totalMonths) * 100;
        
        if (percentage >= 25 && !userData.achievements.find(a => a.title.includes('25%'))) {
            achievements.push({ title: 'ü•â 25% –ø—É—Ç–∏', desc: '–ß–µ—Ç–≤–µ—Ä—Ç—å –¥–æ–ª–≥–∞ –ø–æ–≥–∞—à–µ–Ω–∞' });
        }
        
        if (percentage >= 50 && !userData.achievements.find(a => a.title.includes('50%'))) {
            achievements.push({ title: 'ü•à 50% –ø—É—Ç–∏', desc: '–ü–æ–ª–æ–≤–∏–Ω–∞ –¥–æ–ª–≥–∞ –ø–æ–≥–∞—à–µ–Ω–∞' });
        }
        
        if (percentage >= 75 && !userData.achievements.find(a => a.title.includes('75%'))) {
            achievements.push({ title: 'ü•á 75% –ø—É—Ç–∏', desc: '–ë–æ–ª—å—à–∞—è —á–∞—Å—Ç—å –¥–æ–ª–≥–∞ –ø–æ–≥–∞—à–µ–Ω–∞' });
        }
        
        if (percentage >= 90 && !userData.achievements.find(a => a.title.includes('90%'))) {
            achievements.push({ title: 'üíé 90% –ø—É—Ç–∏', desc: '–ü–æ—á—Ç–∏ —É —Ü–µ–ª–∏!' });
        }
        
        achievements.forEach(achievement => {
            if (!userData.achievements.find(a => a.title === achievement.title)) {
                userData.achievements.push(achievement);
                showMotivation(`üéâ –ù–æ–≤–æ–µ –¥–æ—Å—Ç–∏–∂–µ–Ω–∏–µ: ${achievement.title}!`);
            }
        });
        
        showAchievements();
    }
    
    function showAchievements() {
        if (!userData.achievements || userData.achievements.length === 0) {
            achievementsContainer.innerHTML = `
                <div style="text-align: center; padding: 30px;">
                    <div style="font-size: 4rem; margin-bottom: 20px;">üéØ</div>
                    <h3 style="color: #1A237E; margin-bottom: 15px;">–ù–∞—á–Ω–∏ —Å–≤–æ–π –ø—É—Ç—å –∫ —Å–≤–æ–±–æ–¥–µ!</h3>
                    <p style="color: #5C6BC0;">
                        1. –†–∞—Å—Å—á–∏—Ç–∞–π —Å–≤–æ–π –ø–ª–∞–Ω (–¥–≤–∏–≥–∞–π –ø–æ–ª–∑—É–Ω–∫–∏)<br>
                        2. –û—Ç–º–µ—á–∞–π –≤—ã–ø–æ–ª–Ω–µ–Ω–Ω—ã–µ –ø–ª–∞—Ç–µ–∂–∏ –∫–Ω–æ–ø–∫–æ–π –Ω–∏–∂–µ<br>
                        3. –°–æ–±–∏—Ä–∞–π –¥–æ—Å—Ç–∏–∂–µ–Ω–∏—è!
                    </p>
                </div>
            `;
            return;
        }
        
        let html = `
            <div style="display: grid; grid-template-columns: repeat(auto-fill, minmax(200px, 1fr)); gap: 20px; margin: 20px 0;">
        `;
        
        userData.achievements.forEach(achievement => {
            html += `
                <div style="background: linear-gradient(135deg, #E3F2FD, #BBDEFB); padding: 20px; border-radius: 15px; text-align: center; border: 2px solid #FFD600;">
                    <div style="font-size: 2rem; margin-bottom: 10px;">${achievement.title.split(' ')[0]}</div>
                    <div style="font-weight: bold; color: #1A237E; margin-bottom: 5px;">${achievement.title}</div>
                    <div style="color: #5C6BC0; font-size: 0.9rem;">${achievement.desc}</div>
                </div>
            `;
        });
        
        html += `</div>`;
        
        html += `
            <div style="margin-top: 30px; padding: 20px; background: rgba(255,255,255,0.1); border-radius: 15px;">
                <h4 style="color: #FFD600; margin-bottom: 15px;">üìà –í–∞—à–∞ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞</h4>
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 15px;">
                    <div>
                        <div style="font-size: 0.9rem; color: #90CAF9;">–í—ã–ø–æ–ª–Ω–µ–Ω–æ –ø–ª–∞—Ç–µ–∂–µ–π</div>
                        <div style="font-size: 2rem; font-weight: bold; color: #FFD600;">${userData.completedMonths}</div>
                    </div>
                    <div>
                        <div style="font-size: 0.9rem; color: #90CAF9;">–í—Å–µ–≥–æ –ø–ª–∞—Ç–µ–∂–µ–π</div>
                        <div style="font-size: 2rem; font-weight: bold; color: #4CAF50;">${userData.totalMonths}</div>
                    </div>
                    <div>
                        <div style="font-size: 0.9rem; color: #90CAF9;">–ü—Ä–æ–≥—Ä–µ—Å—Å</div>
                        <div style="font-size: 2rem; font-weight: bold; color: #2979FF;">${((userData.completedMonths / userData.totalMonths) * 100).toFixed(1)}%</div>
                    </div>
                    <div>
                        <div style="font-size: 0.9rem; color: #90CAF9;">–î–æ—Å—Ç–∏–∂–µ–Ω–∏–π</div>
                        <div style="font-size: 2rem; font-weight: bold; color: #9C27B0;">${userData.achievements.length}</div>
                    </div>
                </div>
            </div>
        `;
        
        achievementsContainer.innerHTML = html;
    }
    
    function addAchievement(title, desc) {
        if (!userData.achievements.find(a => a.title === title)) {
            userData.achievements.push({ title, desc });
            saveToLocalStorage();
            showAchievements();
        }
    }
    
    // ============================================
    // –≠–ö–°–ü–û–†–¢ –ò –ü–õ–ê–ù–´
    // ============================================
    
    function calculateFullPlan() {
        calculateFullPlanWithAllMonths();
    }
    
    function savePersonalPlan() {
        if (!userData.totalMonths || userData.totalMonths <= 0) {
            alert('–°–Ω–∞—á–∞–ª–∞ —Ä–∞—Å—Å—á–∏—Ç–∞–π —Å–≤–æ–π –ø–ª–∞–Ω!');
            return;
        }
        
        const plan = generatePlanText();
        const blob = new Blob([plan], { type: 'text/plain;charset=utf-8' });
        const url = URL.createObjectURL(blob);
        const a = document.createElement('a');
        a.href = url;
        a.download = `–í—ã—Ö–æ–¥_–∏–∑_–¥–æ–ª–≥–æ–≤_–ø–ª–∞–Ω_${new Date().toISOString().slice(0,10)}.txt`;
        document.body.appendChild(a);
        a.click();
        document.body.removeChild(a);
        URL.revokeObjectURL(url);
        
        showMotivation('üéâ –¢–≤–æ–π –ø–ª–∞–Ω —Å–æ—Ö—Ä–∞–Ω–µ–Ω! –û—Ç–∫—Ä—ã–≤–∞–π –µ–≥–æ –∫–∞–∂–¥–æ–µ —É—Ç—Ä–æ –¥–ª—è –º–æ—Ç–∏–≤–∞—Ü–∏–∏! üí™');
    }
    
    function generatePlanText() {
        const today = new Date();
        const startDate = userData.startDate ? new Date(userData.startDate) : today;
        
        return `–í–´–•–û–î –ò–ó –î–û–õ–ì–û–í: –ü–û–õ–ù–´–ô –ü–õ–ê–ù –ù–ê –í–ï–°–¨ –°–†–û–ö

üìä –í–ê–®–ò –î–ê–ù–ù–´–ï:
‚Ä¢ –û–±—â–∞—è —Å—É–º–º–∞ –¥–æ–ª–≥–∞: ${formatNumber(userData.debt)} ‚ÇΩ
‚Ä¢ –ï–∂–µ–º–µ—Å—è—á–Ω—ã–π –ø–ª–∞—Ç–µ–∂: ${formatNumber(userData.payment)} ‚ÇΩ
‚Ä¢ –ü—Ä–æ—Ü–µ–Ω—Ç–Ω–∞—è —Å—Ç–∞–≤–∫–∞: ${userData.interest}%
‚Ä¢ –î–∞—Ç–∞ –Ω–∞—á–∞–ª–∞: ${startDate.toLocaleDateString('ru-RU')}

üéØ –í–ê–® –ü–£–¢–¨ –ö –°–í–û–ë–û–î–ï:
‚Ä¢ –û–±—â–∏–π —Å—Ä–æ–∫: ${userData.totalMonths} –º–µ—Å—è—Ü–µ–≤
‚Ä¢ –í—ã–ø–æ–ª–Ω–µ–Ω–æ: ${userData.completedMonths} –º–µ—Å—è—Ü–µ–≤
‚Ä¢ –û—Å—Ç–∞–ª–æ—Å—å: ${userData.totalMonths - userData.completedMonths} –º–µ—Å—è—Ü–µ–≤
‚Ä¢ –î–∞—Ç–∞ –æ—Å–≤–æ–±–æ–∂–¥–µ–Ω–∏—è: ${userData.freedomDate}
‚Ä¢ –ü—Ä–æ–≥—Ä–µ—Å—Å: ${((userData.completedMonths / userData.totalMonths) * 100).toFixed(1)}%

üí∞ –§–ò–ù–ê–ù–°–û–í–´–ï –ò–¢–û–ì–ò:
‚Ä¢ –í—Å–µ–≥–æ –≤—ã–ø–ª–∞—Ç–∏—Ç–µ: ${formatNumber(userData.payment * userData.totalMonths)} ‚ÇΩ
‚Ä¢ –ò–∑ –Ω–∏—Ö –ø—Ä–æ—Ü–µ–Ω—Ç—ã: ${formatNumber((userData.payment * userData.totalMonths) - userData.debt)} ‚ÇΩ
‚Ä¢ –£–∂–µ –≤—ã–ø–ª–∞—á–µ–Ω–æ: ${formatNumber(userData.payment * userData.completedMonths)} ‚ÇΩ

üìÖ –ì–†–ê–§–ò–ö –ü–õ–ê–¢–ï–ñ–ï–ô (–ø–µ—Ä–≤—ã–µ 12 –º–µ—Å—è—Ü–µ–≤):
${userData.monthlyDetails.slice(0, 12).map(detail => {
    const paymentDate = new Date(startDate);
    paymentDate.setMonth(paymentDate.getMonth() + detail.month - 1);
    const dateStr = paymentDate.toLocaleDateString('ru-RU', { month: 'short', year: 'numeric' });
    const status = detail.month <= userData.completedMonths ? '‚úÖ' : 'üìÖ';
    return `–ú–µ—Å—è—Ü ${detail.month} (${dateStr}): ${formatNumber(detail.payment)} ‚ÇΩ - ${status}`;
}).join('\n')}
${userData.totalMonths > 12 ? `... –∏ –µ—â–µ ${userData.totalMonths - 12} –º–µ—Å—è—Ü–µ–≤` : ''}

üèÜ –î–û–°–¢–ò–ñ–ï–ù–ò–Ø:
${userData.achievements.length > 0 ? userData.achievements.map(a => `‚Ä¢ ${a.title} - ${a.desc}`).join('\n') : '–ü–æ–∫–∞ –Ω–µ—Ç –¥–æ—Å—Ç–∏–∂–µ–Ω–∏–π'}

üí° –°–û–í–ï–¢–´:
1. –ü–ª–∞—Ç–∏ –≤–æ–≤—Ä–µ–º—è, –æ—Ç–º–µ—á–∞–π –≤ –∫–∞–ª—å–∫—É–ª—è—Ç–æ—Ä–µ
2. –†–∞—Å—Å–º–æ—Ç—Ä–∏ —É—Å–∫–æ—Ä–µ–Ω–Ω—ã–π –ø–ª–∞–Ω –µ—Å–ª–∏ –ø–æ—è–≤–∏—Ç—Å—è –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å
3. –ù–µ –ø—Ä–æ–ø—É—Å–∫–∞–π –ø–ª–∞—Ç–µ–∂–∏
4. –ü–æ–º–Ω–∏: –∫–∞–∂–¥—ã–π –ø–ª–∞—Ç–µ–∂ - —à–∞–≥ –∫ —Å–≤–æ–±–æ–¥–µ!

–°–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω–æ: ${new Date().toLocaleDateString('ru-RU')}
–î–û–ú–ï–ù–ó–ê–î–û–õ–ñ–ï–ù.–†–§
        `.trim();
    }
    
    function exportToPDF() {
        if (!window.jspdf) {
            alert('–ë–∏–±–ª–∏–æ—Ç–µ–∫–∞ PDF –Ω–µ –∑–∞–≥—Ä—É–∂–µ–Ω–∞. –ü–æ–ø—Ä–æ–±—É–π –ø–æ–∑–∂–µ.');
            return;
        }
        
        if (!userData.totalMonths || userData.totalMonths <= 0) {
            alert('–°–Ω–∞—á–∞–ª–∞ —Ä–∞—Å—Å—á–∏—Ç–∞–π —Å–≤–æ–π –ø–ª–∞–Ω!');
            return;
        }
        
        const { jsPDF } = window.jspdf;
        const doc = new jsPDF();
        
        // –ó–∞–≥–æ–ª–æ–≤–æ–∫
        doc.setFillColor(26, 35, 126);
        doc.rect(0, 0, 210, 30, 'F');
        doc.setTextColor(255, 214, 0);
        doc.setFontSize(20);
        doc.text('–í–´–•–û–î –ò–ó –î–û–õ–ì–û–í 2026', 105, 20, { align: 'center' });
        
        doc.setTextColor(26, 35, 126);
        doc.setFontSize(12);
        
        let y = 40;
        doc.text(`–î–∞—Ç–∞: ${new Date().toLocaleDateString('ru-RU')}`, 20, y);
        y += 10;
        
        doc.setFontSize(14);
        doc.text('–í–ê–® –ü–õ–ê–ù –ü–û–ì–ê–®–ï–ù–ò–Ø –î–û–õ–ì–û–í', 20, y);
        y += 10;
        
        doc.setFontSize(12);
        doc.text(`–°—É–º–º–∞ –¥–æ–ª–≥–∞: ${formatNumber(userData.debt)} ‚ÇΩ`, 20, y);
        y += 7;
        doc.text(`–ï–∂–µ–º–µ—Å—è—á–Ω—ã–π –ø–ª–∞—Ç–µ–∂: ${formatNumber(userData.payment)} ‚ÇΩ`, 20, y);
        y += 7;
        doc.text(`–°—Ä–æ–∫: ${userData.totalMonths} –º–µ—Å—è—Ü–µ–≤`, 20, y);
        y += 7;
        doc.text(`–î–∞—Ç–∞ –æ—Å–≤–æ–±–æ–∂–¥–µ–Ω–∏—è: ${userData.freedomDate}`, 20, y);
        y += 7;
        doc.text(`–ü—Ä–æ–≥—Ä–µ—Å—Å: ${userData.completedMonths}/${userData.totalMonths} –º–µ—Å—è—Ü–µ–≤`, 20, y);
        y += 10;
        
        doc.setFontSize(11);
        doc.text('–†–∞—Å–ø–µ—á–∞—Ç–∞–π —ç—Ç–æ—Ç –ø–ª–∞–Ω –∏ –ø–æ–≤–µ—Å—å –Ω–∞ –≤–∏–¥–Ω–æ–µ –º–µ—Å—Ç–æ!', 20, y);
        y += 15;
        
        doc.text('–° —É–≤–∞–∂–µ–Ω–∏–µ–º, –î–û–ú–ï–ù–ó–ê–î–û–õ–ñ–ï–ù.–†–§', 20, y);
        
        doc.save(`–ü–ª–∞–Ω_–≤—ã—Ö–æ–¥–∞_–∏–∑_–¥–æ–ª–≥–æ–≤_${new Date().toISOString().slice(0,10)}.pdf`);
        showMotivation('üìÑ PDF —Å–æ—Ö—Ä–∞–Ω–µ–Ω! –†–∞—Å–ø–µ—á–∞—Ç–∞–π –∏ –ø–æ–≤–µ—Å—å –Ω–∞ –≤–∏–¥–Ω–æ–µ –º–µ—Å—Ç–æ! üéØ');
    }
    
    function applyPlan(planNumber) {
        const debt = parseInt(debtSlider.value);
        
        switch(planNumber) {
            case 1: // –°—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–π
                paymentSlider.value = Math.max(1000, Math.min(200000, debt * 0.05));
                interestSlider.value = 15;
                break;
            case 2: // –£—Å–∫–æ—Ä–µ–Ω–Ω—ã–π
                paymentSlider.value = Math.max(1000, Math.min(200000, debt * 0.07));
                interestSlider.value = 15;
                break;
            case 3: // –†–µ—Å—Ç—Ä—É–∫—Ç—É—Ä–∏–∑–∞—Ü–∏—è
                paymentSlider.value = Math.max(1000, Math.min(200000, debt * 0.035));
                interestSlider.value = 20;
                break;
        }
        
        updatePayment();
        updateInterest();
        calculateFullPlanWithAllMonths();
        
        const planNames = ["", "–°—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–π", "–£—Å–∫–æ—Ä–µ–Ω–Ω—ã–π", "–†–µ—Å—Ç—Ä—É–∫—Ç—É—Ä–∏–∑–∞—Ü–∏—è"];
        showMotivation(`‚úÖ –ü–ª–∞–Ω "${planNames[planNumber]}" –ø—Ä–∏–º–µ–Ω–µ–Ω! –°–º–æ—Ç—Ä–∏ –Ω–æ–≤—ã–π –≥—Ä–∞—Ñ–∏–∫ –Ω–∏–∂–µ. üìä`);
    }
    
    function resetCalculator() {
        if (confirm('–°–±—Ä–æ—Å–∏—Ç—å –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –∫–∞–ª—å–∫—É–ª—è—Ç–æ—Ä–∞? –î–∞–Ω–Ω—ã–µ —Å–æ—Ö—Ä–∞–Ω—è—Ç—Å—è.')) {
            debtSlider.value = 500000;
            paymentSlider.value = 25000;
            interestSlider.value = 15;
            
            updateDebt();
            updatePayment();
            updateInterest();
            
            showMotivation('üîÑ –ö–∞–ª—å–∫—É–ª—è—Ç–æ—Ä —Å–±—Ä–æ—à–µ–Ω! –ú–µ–Ω—è–π –∑–Ω–∞—á–µ–Ω–∏—è –∏ —Å–º–æ—Ç—Ä–∏ –Ω–æ–≤—ã–π –ø–ª–∞–Ω. üí™');
        }
    }
    
    // ============================================
    // –í–°–ü–û–ú–û–ì–ê–¢–ï–õ–¨–ù–´–ï –§–£–ù–ö–¶–ò–ò
    // ============================================
    
    function showRandomMotivation() {
        if (Math.random() > 0.5) {
            const msg = motivationMessages[Math.floor(Math.random() * motivationMessages.length)];
            showMotivation(msg);
        }
    }
    
    function showMotivation(message) {
        document.querySelectorAll('.motivation-toast').forEach(toast => toast.remove());
        
        const toast = document.createElement('div');
        toast.className = 'motivation-toast';
        toast.textContent = message;
        document.body.appendChild(toast);
        
        setTimeout(() => {
            toast.style.animation = 'slideOutRight 0.5s ease-out';
            setTimeout(() => toast.remove(), 500);
        }, 4000);
    }
    
    function showAutoSaveIndicator() {
        const indicator = document.createElement('div');
        indicator.className = 'auto-save-indicator';
        indicator.textContent = 'üíæ –î–∞–Ω–Ω—ã–µ —Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã';
        document.body.appendChild(indicator);
        
        setTimeout(() => indicator.remove(), 2000);
    }
    
    function copyWallet() {
        const wallet = '4100118986223649';
        navigator.clipboard.writeText(wallet).then(() => {
            const element = document.getElementById('walletNumber');
            const originalText = element.textContent;
            
            element.textContent = '‚úÖ –°–ö–û–ü–ò–†–û–í–ê–ù–û! –°–ü–ê–°–ò–ë–û!';
            element.style.color = '#4CAF50';
            
            setTimeout(() => {
                element.textContent = originalText;
                element.style.color = '';
            }, 2000);
            
            showMotivation('üí´ –ö–æ—à–µ–ª–µ–∫ —Å–∫–æ–ø–∏—Ä–æ–≤–∞–Ω! –°–ø–∞—Å–∏–±–æ –∑–∞ –ø–æ–¥–¥–µ—Ä–∂–∫—É –ø—Ä–æ–µ–∫—Ç–∞! üåÖ');
        }).catch(err => {
            console.error('–û—à–∏–±–∫–∞ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏—è:', err);
            showMotivation('üìã –°–∫–æ–ø–∏—Ä—É–π –Ω–æ–º–µ—Ä –≤—Ä—É—á–Ω—É—é: 4100 1189 8622 3649');
        });
    }
    
    function showSuccessStories() {
        document.getElementById('stories').style.display = 'block';
        document.getElementById('stories').scrollIntoView({ behavior: 'smooth' });
    }
    
    function setCurrentDate() {
        const now = new Date();
        const options = { day: 'numeric', month: 'long', year: 'numeric' };
        const dateString = now.toLocaleDateString('ru-RU', options);
        document.getElementById('currentDate').textContent = dateString;
    }
    
    function createStars() {
        const starsContainer = document.getElementById('stars');
        for (let i = 0; i < 150; i++) {
            const star = document.createElement('div');
            star.classList.add('star');
            star.style.width = Math.random() * 3 + 1 + 'px';
            star.style.height = star.style.width;
            star.style.left = Math.random() * 100 + '%';
            star.style.top = Math.random() * 100 + '%';
            star.style.animationDelay = Math.random() * 3 + 's';
            star.style.animationDuration = Math.random() * 2 + 2 + 's';
            starsContainer.appendChild(star);
        }
    }
    
    // ============================================
    // –ò–ù–ò–¶–ò–ê–õ–ò–ó–ê–¶–ò–Ø
    // ============================================
    
    document.addEventListener('DOMContentLoaded', function() {
        createStars();
        setCurrentDate();
        loadFromLocalStorage();
        
        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –∑–Ω–∞—á–µ–Ω–∏–π
        updateDebt();
        updatePayment();
        updateInterest();
        
        // –ü–ª–∞–≤–Ω–∞—è –ø—Ä–æ–∫—Ä—É—Ç–∫–∞ –ø–æ —è–∫–æ—Ä—è–º
        document.querySelectorAll('a[href^="#"]').forEach(anchor => {
            anchor.addEventListener('click', function(e) {
                e.preventDefault();
                const targetId = this.getAttribute('href');
                if (targetId === '#') return;
                
                const targetElement = document.querySelector(targetId);
                if (targetElement) {
                    targetElement.scrollIntoView({
                        behavior: 'smooth',
                        block: 'start'
                    });
                }
            });
        });
        
        // –ê–≤—Ç–æ—Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ —Å–ª–∞–π–¥–µ—Ä–æ–≤
        [debtSlider, paymentSlider, interestSlider].forEach(slider => {
            slider.addEventListener('change', saveToLocalStorage);
        });
        
        // –ü–µ—Ä–≤—ã–π —Ä–∞—Å—á–µ—Ç –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ
        setTimeout(() => {
            calculateFullPlanWithAllMonths();
            if (userData.completedMonths > 0) {
                showMotivation(`–° –≤–æ–∑–≤—Ä–∞—â–µ–Ω–∏–µ–º! –¢—ã —É–∂–µ –Ω–∞ ${((userData.completedMonths / userData.totalMonths) * 100).toFixed(1)}% –ø—É—Ç–∏!`);
            }
        }, 500);
    });
</script>
